<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ðŸ“‹ Gestionnaire de TÃ¢ches Pro</title>
    <meta
      name="description"
      content="Gestionnaire de tÃ¢ches moderne et professionnel avec interface web intuitive"
    />
    <meta
      name="keywords"
      content="tÃ¢ches, gestion, productivitÃ©, todo, liste"
    />
    <meta name="author" content="Gestionnaire de TÃ¢ches Pro" />

    <!-- CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <link rel="stylesheet" href="/static/style.css" />

    <!-- Preload critical resources -->
    <link rel="preload" href="/static/style.css" as="style" />
    <link rel="preload" href="/static/app.js" as="script" />
  </head>
  <body class="bg-light">
    <!-- Loading Screen -->
    <div
      id="loading-screen"
      class="loading-screen"
      aria-label="Chargement"
      role="status"
    >
      <div class="loading-content">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Chargement...</span>
        </div>
        <h3 class="mt-3 text-primary">Gestionnaire de TÃ¢ches Pro</h3>
        <p class="text-muted">Chargement en cours...</p>
      </div>
    </div>

    <!-- Authentification -->
    <div
      id="auth-container"
      class="auth-container"
      role="main"
      aria-label="Authentification"
    >
      <div
        class="form-container animate__animated animate__fadeIn"
        id="login-view"
      >
        <form class="form" id="login-form" aria-label="Formulaire de connexion">
          <p id="heading">Connexion</p>
          <div class="field">
            <svg
              class="input-icon"
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M13.106 7.222c0-2.967-2.249-5.032-5.482-5.032-3.35 0-5.646 2.318-5.646 5.702 0 3.493 2.235 5.708 5.762 5.708.862 0 1.689-.123 2.304-.335v-.862c-.43.199-1.354.328-2.29.328-2.926 0-4.813-1.88-4.813-4.798 0-2.844 1.921-4.881 4.594-4.881 2.735 0 4.608 1.688 4.608 4.156 0 1.682-.554 2.769-1.416 2.769-.492 0-.772-.28-.772-.76V5.206H8.923v.834h-.11c-.266-.595-.881-.964-1.6-.964-1.4 0-2.378 1.162-2.378 2.823 0 1.737.957 2.906 2.379 2.906.8 0 1.415-.39 1.709-1.087h.11c.081.67.703 1.148 1.503 1.148 1.572 0 2.57-1.415 2.57-3.643zm-7.177.704c0-1.197.54-1.907 1.456-1.907.93 0 1.524.738 1.524 1.907S8.308 9.84 7.371 9.84c-.895 0-1.442-.725-1.442-1.914z"
              ></path>
            </svg>
            <input
              autocomplete="off"
              placeholder="Email"
              class="input-field"
              type="email"
              id="login-email"
              required
              aria-required="true"
              aria-label="Email"
            />
          </div>
          <div class="field">
            <svg
              class="input-icon"
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"
              ></path>
            </svg>
            <input
              placeholder="Mot de passe"
              class="input-field"
              type="password"
              id="login-password"
              required
              aria-required="true"
              aria-label="Mot de passe"
            />
          </div>
          <div class="btn">
            <button class="button1" type="submit" aria-label="Se connecter">
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Connexion&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            </button>
            <button
              class="button2"
              type="button"
              id="show-register"
              aria-label="S'inscrire"
            >
              Inscription
            </button>
          </div>
          <button
            class="button3"
            type="button"
            aria-label="Mot de passe oubliÃ©"
          >
            Mot de passe oubliÃ©
          </button>
        </form>
      </div>

      <div
        class="form-container animate__animated animate__fadeIn"
        id="register-view"
        style="display: none"
      >
        <form
          class="form"
          id="register-form"
          aria-label="Formulaire d'inscription"
        >
          <p id="heading">Inscription</p>
          <div class="field">
            <svg
              class="input-icon"
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M13.106 7.222c0-2.967-2.249-5.032-5.482-5.032-3.35 0-5.646 2.318-5.646 5.702 0 3.493 2.235 5.708 5.762 5.708.862 0 1.689-.123 2.304-.335v-.862c-.43.199-1.354.328-2.29.328-2.926 0-4.813-1.88-4.813-4.798 0-2.844 1.921-4.881 4.594-4.881 2.735 0 4.608 1.688 4.608 4.156 0 1.682-.554 2.769-1.416 2.769-.492 0-.772-.28-.772-.76V5.206H8.923v.834h-.11c-.266-.595-.881-.964-1.6-.964-1.4 0-2.378 1.162-2.378 2.823 0 1.737.957 2.906 2.379 2.906.8 0 1.415-.39 1.709-1.087h.11c.081.67.703 1.148 1.503 1.148 1.572 0 2.57-1.415 2.57-3.643zm-7.177.704c0-1.197.54-1.907 1.456-1.907.93 0 1.524.738 1.524 1.907S8.308 9.84 7.371 9.84c-.895 0-1.442-.725-1.442-1.914z"
              ></path>
            </svg>
            <input
              autocomplete="off"
              placeholder="Email"
              class="input-field"
              type="email"
              id="register-email"
              required
              aria-required="true"
              aria-label="Email"
            />
          </div>
          <div class="field">
            <svg
              class="input-icon"
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"
              ></path>
            </svg>
            <input
              placeholder="Mot de passe"
              class="input-field"
              type="password"
              id="register-password"
              required
              minlength="6"
              aria-required="true"
              aria-label="Mot de passe"
            />
          </div>
          <div class="btn">
            <button class="button1" type="submit" aria-label="S'inscrire">
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Inscription&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            </button>
            <button
              class="button2"
              type="button"
              id="show-login"
              aria-label="Se connecter"
            >
              Connexion
            </button>
          </div>
          <button class="button3" type="button" aria-label="Retour">
            Retour
          </button>
        </form>
      </div>
    </div>

    <!-- Application principale -->
    <div
      id="app-container"
      class="app-container"
      style="display: none"
      aria-label="Application principale"
    >
      <!-- Header -->
      <header
        class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top"
        role="banner"
      >
        <div class="container-fluid">
          <div class="navbar-brand d-flex align-items-center">
            <i
              class="fas fa-tasks fa-2x text-primary me-3"
              aria-hidden="true"
            ></i>
            <div>
              <h1 class="h4 mb-0 text-primary fw-bold">
                Gestionnaire de TÃ¢ches Pro
              </h1>
              <small class="text-muted">Organisez votre productivitÃ©</small>
            </div>
          </div>

          <div class="navbar-nav ms-auto" aria-label="Menu utilisateur">
            <div class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="userDropdown"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                aria-label="Menu utilisateur"
              >
                <i class="fas fa-user-circle me-2" aria-hidden="true"></i>
                <span id="user-email"></span>
              </a>
              <ul class="dropdown-menu" aria-labelledby="userDropdown">
                <li>
                  <a class="dropdown-item" href="#" id="profile-link"
                    ><i class="fas fa-user me-2" aria-hidden="true"></i
                    >Profil</a
                  >
                </li>
                <li>
                  <a class="dropdown-item" href="#" id="settings-link"
                    ><i class="fas fa-cog me-2" aria-hidden="true"></i
                    >ParamÃ¨tres</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item text-danger" href="#" id="logout-btn"
                    ><i class="fas fa-sign-out-alt me-2" aria-hidden="true"></i
                    >DÃ©connexion</a
                  >
                </li>
              </ul>
            </div>
            <button
              id="toggle-dark"
              class="btn btn-outline-secondary ms-2"
              title="Mode sombre"
              aria-label="Basculer le mode sombre"
            >
              <i class="fas fa-moon" aria-hidden="true"></i>
            </button>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <main
        class="container-fluid py-4"
        role="main"
        aria-label="Contenu principal"
      >
        <!-- Stats Cards -->
        <div class="row mb-4" aria-label="Statistiques des tÃ¢ches">
          <div class="col-md-3">
            <div class="card bg-primary text-white">
              <div class="card-body">
                <div class="d-flex justify-content-between">
                  <div>
                    <h6 class="card-title">Total TÃ¢ches</h6>
                    <h3 id="total-tasks">0</h3>
                  </div>
                  <i
                    class="fas fa-tasks fa-2x opacity-75"
                    aria-hidden="true"
                  ></i>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card bg-success text-white">
              <div class="card-body">
                <div class="d-flex justify-content-between">
                  <div>
                    <h6 class="card-title">TerminÃ©es</h6>
                    <h3 id="completed-tasks">0</h3>
                  </div>
                  <i
                    class="fas fa-check-circle fa-2x opacity-75"
                    aria-hidden="true"
                  ></i>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card bg-warning text-white">
              <div class="card-body">
                <div class="d-flex justify-content-between">
                  <div>
                    <h6 class="card-title">En Cours</h6>
                    <h3 id="pending-tasks">0</h3>
                  </div>
                  <i
                    class="fas fa-clock fa-2x opacity-75"
                    aria-hidden="true"
                  ></i>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card bg-danger text-white">
              <div class="card-body">
                <div class="d-flex justify-content-between">
                  <div>
                    <h6 class="card-title">Urgentes</h6>
                    <h3 id="urgent-tasks">0</h3>
                  </div>
                  <i
                    class="fas fa-exclamation-triangle fa-2x opacity-75"
                    aria-hidden="true"
                  ></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Add Task Form -->
        <div class="card mb-4" aria-label="Ajouter une tÃ¢che">
          <div class="card-header bg-white">
            <h5 class="mb-0">
              <i class="fas fa-plus me-2" aria-hidden="true"></i>Nouvelle TÃ¢che
            </h5>
          </div>
          <div class="card-body">
            <form
              id="task-form"
              class="row g-3"
              aria-label="Formulaire d'ajout de tÃ¢che"
            >
              <div class="col-md-4">
                <label for="title" class="form-label">Titre *</label>
                <input
                  type="text"
                  class="form-control"
                  id="title"
                  name="title"
                  placeholder="Titre de la tÃ¢che"
                  required
                  aria-required="true"
                  aria-label="Titre de la tÃ¢che"
                />
              </div>
              <div class="col-md-3">
                <label for="description" class="form-label">Description</label>
                <input
                  type="text"
                  class="form-control"
                  id="description"
                  name="description"
                  placeholder="Description"
                  aria-label="Description de la tÃ¢che"
                />
              </div>
              <div class="col-md-2">
                <label for="priority" class="form-label">PrioritÃ©</label>
                <select
                  class="form-select"
                  id="priority"
                  name="priority"
                  aria-label="PrioritÃ©"
                >
                  <option value="basse">Basse</option>
                  <option value="normale" selected>Normale</option>
                  <option value="haute">Haute</option>
                </select>
              </div>
              <div class="col-md-2">
                <label for="category" class="form-label">CatÃ©gorie</label>
                <select
                  class="form-select"
                  id="category"
                  name="category"
                  aria-label="CatÃ©gorie"
                  onchange="toggleCustomCategory()"
                >
                  <option value="travail">Travail</option>
                  <option value="personnel">Personnel</option>
                  <option value="sante">SantÃ©</option>
                  <option value="apprentissage">Apprentissage</option>
                  <option value="autre">Autre</option>
                </select>
                <input
                  type="text"
                  class="form-control mt-2"
                  id="custom-category"
                  name="custom-category"
                  placeholder="Votre catÃ©gorie..."
                  style="display: none"
                  aria-label="CatÃ©gorie personnalisÃ©e"
                />
              </div>
              <div class="col-md-1">
                <label class="form-label visually-hidden">Ajouter</label>
                <button
                  type="submit"
                  class="btn btn-primary w-100"
                  aria-label="Ajouter la tÃ¢che"
                >
                  <i class="fas fa-plus" aria-hidden="true"></i>
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Filters -->
        <div class="card mb-4" aria-label="Filtres de recherche">
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-4">
                <label for="search" class="form-label">Rechercher</label>
                <div class="input-group">
                  <span class="input-group-text"
                    ><i class="fas fa-search" aria-hidden="true"></i
                  ></span>
                  <input
                    type="text"
                    class="form-control"
                    id="search"
                    placeholder="Rechercher une tÃ¢che..."
                    aria-label="Rechercher une tÃ¢che"
                  />
                </div>
              </div>
              <div class="col-md-2">
                <label for="filter-priority" class="form-label">PrioritÃ©</label>
                <select
                  class="form-select"
                  id="filter-priority"
                  aria-label="Filtrer par prioritÃ©"
                >
                  <option value="">Toutes</option>
                  <option value="basse">Basse</option>
                  <option value="normale">Normale</option>
                  <option value="haute">Haute</option>
                </select>
              </div>
              <div class="col-md-2">
                <label for="filter-category" class="form-label"
                  >CatÃ©gorie</label
                >
                <select
                  class="form-select"
                  id="filter-category"
                  aria-label="Filtrer par catÃ©gorie"
                >
                  <option value="">Toutes</option>
                  <option value="travail">Travail</option>
                  <option value="personnel">Personnel</option>
                  <option value="sante">SantÃ©</option>
                  <option value="apprentissage">Apprentissage</option>
                  <option value="autre">Autre</option>
                </select>
              </div>
              <div class="col-md-2">
                <label for="filter-status" class="form-label">Statut</label>
                <select
                  class="form-select"
                  id="filter-status"
                  aria-label="Filtrer par statut"
                >
                  <option value="">Tous</option>
                  <option value="pending">En cours</option>
                  <option value="completed">TerminÃ©es</option>
                </select>
              </div>
              <div class="col-md-2">
                <label class="form-label visually-hidden">Effacer</label>
                <button
                  id="clear-filters"
                  class="btn btn-outline-secondary w-100"
                  aria-label="Effacer les filtres"
                >
                  <i class="fas fa-times me-2" aria-hidden="true"></i>Effacer
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Tasks List -->
        <div class="card shadow-sm" aria-label="Liste des tÃ¢ches">
          <div
            class="card-header bg-white d-flex justify-content-between align-items-center border-0"
          >
            <div class="d-flex align-items-center">
              <h5 class="mb-0 fw-bold text-primary">
                <i class="fas fa-list me-2" aria-hidden="true"></i>Mes TÃ¢ches
              </h5>
              <span class="badge bg-primary ms-2" id="task-count"
                >0 tÃ¢ches</span
              >
            </div>
            <div class="d-flex gap-2">
              <div class="btn-group" role="group" aria-label="Tri des tÃ¢ches">
                <button
                  type="button"
                  class="btn btn-outline-primary btn-sm active"
                  id="sort-date"
                  aria-label="Trier par date"
                  title="Trier par date de crÃ©ation"
                >
                  <i class="fas fa-calendar me-1" aria-hidden="true"></i>Date
                </button>
                <button
                  type="button"
                  class="btn btn-outline-primary btn-sm"
                  id="sort-priority"
                  aria-label="Trier par prioritÃ©"
                  title="Trier par prioritÃ©"
                >
                  <i class="fas fa-exclamation me-1" aria-hidden="true"></i
                  >PrioritÃ©
                </button>
                <button
                  type="button"
                  class="btn btn-outline-primary btn-sm"
                  id="sort-name"
                  aria-label="Trier par nom"
                  title="Trier par nom"
                >
                  <i class="fas fa-sort-alpha-down me-1" aria-hidden="true"></i
                  >Nom
                </button>
              </div>
              <button
                type="button"
                class="btn btn-outline-success btn-sm"
                id="bulk-complete"
                aria-label="Marquer toutes comme terminÃ©es"
                title="Marquer toutes comme terminÃ©es"
                style="display: none"
              >
                <i class="fas fa-check-double me-1" aria-hidden="true"></i>Tout
                terminer
              </button>
            </div>
          </div>
          <div class="card-body p-0">
            <!-- Progress Bar -->
            <div class="progress rounded-0" style="height: 4px">
              <div
                class="progress-bar bg-success"
                id="completion-progress"
                role="progressbar"
                style="width: 0%"
                aria-valuenow="0"
                aria-valuemin="0"
                aria-valuemax="100"
              ></div>
            </div>

            <!-- Task List Container -->
            <div class="task-list-container">
              <div
                id="task-list"
                class="list-group list-group-flush"
                role="list"
                aria-label="TÃ¢ches"
              ></div>

              <!-- Empty State -->
              <div id="no-tasks" class="text-center py-5" style="display: none">
                <div class="empty-state">
                  <i
                    class="fas fa-clipboard-list fa-4x text-muted mb-4"
                    aria-hidden="true"
                  ></i>
                  <h4 class="text-muted mb-3">Aucune tÃ¢che trouvÃ©e</h4>
                  <p class="text-muted mb-4">
                    Commencez par ajouter votre premiÃ¨re tÃ¢che pour organiser
                    votre productivitÃ© !
                  </p>
                  <button
                    type="button"
                    class="btn btn-primary"
                    onclick="document.getElementById('title').focus()"
                    aria-label="Ajouter une premiÃ¨re tÃ¢che"
                  >
                    <i class="fas fa-plus me-2" aria-hidden="true"></i>Ajouter
                    ma premiÃ¨re tÃ¢che
                  </button>
                </div>
              </div>

              <!-- Loading State -->
              <div
                id="loading-tasks"
                class="text-center py-5"
                style="display: none"
              >
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Chargement des tÃ¢ches...</span>
                </div>
                <p class="text-muted mt-3">Chargement de vos tÃ¢ches...</p>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Toast Notifications -->
    <div
      id="notification"
      class="toast align-items-center text-bg-primary border-0 position-fixed bottom-0 end-0 m-4"
      role="alert"
      aria-live="assertive"
      aria-atomic="true"
      style="z-index: 9999; display: none"
    >
      <div class="d-flex">
        <div class="toast-body"></div>
        <button
          type="button"
          class="btn-close btn-close-white me-2 m-auto"
          data-bs-dismiss="toast"
          aria-label="Fermer"
        ></button>
      </div>
    </div>

    <!-- Task Edit Modal -->
    <div
      class="modal fade"
      id="taskEditModal"
      tabindex="-1"
      aria-labelledby="taskEditModalLabel"
      aria-modal="true"
      role="dialog"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="taskEditModalLabel">
              <i class="fas fa-edit me-2" aria-hidden="true"></i>Modifier la
              TÃ¢che
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Fermer"
            ></button>
          </div>
          <div class="modal-body">
            <div
              id="edit-task-info"
              class="alert alert-info d-none"
              role="alert"
            >
              <i class="fas fa-info-circle me-2" aria-hidden="true"></i>
              <strong>Information :</strong> Les tÃ¢ches terminÃ©es ne peuvent pas
              Ãªtre modifiÃ©es.
            </div>
            <form
              id="edit-task-form"
              aria-label="Formulaire de modification de tÃ¢che"
            >
              <div class="mb-3">
                <label for="edit-title" class="form-label">Titre</label>
                <input
                  type="text"
                  class="form-control"
                  id="edit-title"
                  required
                  aria-required="true"
                  aria-label="Titre de la tÃ¢che"
                />
              </div>
              <div class="mb-3">
                <label for="edit-description" class="form-label"
                  >Description</label
                >
                <textarea
                  class="form-control"
                  id="edit-description"
                  rows="3"
                  aria-label="Description de la tÃ¢che"
                ></textarea>
              </div>
              <div class="row">
                <div class="col-md-6">
                  <label for="edit-priority" class="form-label">PrioritÃ©</label>
                  <select
                    class="form-select"
                    id="edit-priority"
                    aria-label="PrioritÃ©"
                  >
                    <option value="basse">Basse</option>
                    <option value="normale">Normale</option>
                    <option value="haute">Haute</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label for="edit-category" class="form-label"
                    >CatÃ©gorie</label
                  >
                  <select
                    class="form-select"
                    id="edit-category"
                    aria-label="CatÃ©gorie"
                    onchange="toggleEditCustomCategory()"
                  >
                    <option value="travail">Travail</option>
                    <option value="personnel">Personnel</option>
                    <option value="sante">SantÃ©</option>
                    <option value="apprentissage">Apprentissage</option>
                    <option value="autre">Autre</option>
                  </select>
                  <input
                    type="text"
                    class="form-control mt-2"
                    id="edit-custom-category"
                    name="edit-custom-category"
                    placeholder="Votre catÃ©gorie..."
                    style="display: none"
                    aria-label="CatÃ©gorie personnalisÃ©e"
                  />
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
              aria-label="Annuler"
            >
              Annuler
            </button>
            <button
              type="button"
              class="btn btn-primary"
              id="save-edit"
              aria-label="Enregistrer"
            >
              Enregistrer
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/api_helper.js"></script>
    <script src="/static/auth.js"></script>
    <script src="/static/app.js"></script>

    <script>
      // Fonction pour basculer le mode sombre
      function toggleDarkMode() {
        const body = document.body;
        const isDark = body.classList.contains("dark-mode");

        if (isDark) {
          body.classList.remove("dark-mode");
          localStorage.setItem("darkMode", "false");
          updateDarkModeIcon(false);
        } else {
          body.classList.add("dark-mode");
          localStorage.setItem("darkMode", "true");
          updateDarkModeIcon(true);
        }

        // Forcer la mise Ã  jour des Ã©lÃ©ments qui pourraient ne pas se mettre Ã  jour automatiquement
        updateDarkModeElements();
      }

      // Fonction pour mettre Ã  jour l'icÃ´ne du bouton
      function updateDarkModeIcon(isDark) {
        const icon = document.querySelector("#toggle-dark i");
        if (icon) {
          icon.className = isDark ? "fas fa-sun" : "fas fa-moon";
        }
      }

      // Fonction pour mettre Ã  jour les Ã©lÃ©ments spÃ©cifiques
      function updateDarkModeElements() {
        // Mettre Ã  jour les cartes de stats
        const statsCards = document.querySelectorAll(
          ".card.bg-primary, .card.bg-success, .card.bg-warning, .card.bg-danger"
        );
        statsCards.forEach((card) => {
          if (document.body.classList.contains("dark-mode")) {
            card.style.color = "#fff";
          } else {
            card.style.color = "";
          }
        });

        // Mettre Ã  jour les badges
        const badges = document.querySelectorAll(".badge");
        badges.forEach((badge) => {
          if (document.body.classList.contains("dark-mode")) {
            badge.style.color = "#fff";
          } else {
            badge.style.color = "";
          }
        });

        // Mettre Ã  jour les spinners
        const spinners = document.querySelectorAll(
          ".spinner-border.text-primary"
        );
        spinners.forEach((spinner) => {
          if (document.body.classList.contains("dark-mode")) {
            spinner.style.color = "var(--primary)";
          } else {
            spinner.style.color = "";
          }
        });

        // Mettre Ã  jour les icÃ´nes dans les boutons
        const buttons = document.querySelectorAll(".btn .fas");
        buttons.forEach((icon) => {
          const button = icon.closest(".btn");
          if (button) {
            if (
              button.classList.contains("btn-primary") ||
              button.classList.contains("btn-success") ||
              button.classList.contains("btn-danger")
            ) {
              icon.style.color = "#fff";
            } else if (button.classList.contains("btn-outline-primary")) {
              icon.style.color = document.body.classList.contains("dark-mode")
                ? "var(--primary)"
                : "var(--primary)";
            } else if (button.classList.contains("btn-outline-secondary")) {
              icon.style.color = document.body.classList.contains("dark-mode")
                ? "var(--text-light)"
                : "#6c757d";
            } else if (button.classList.contains("btn-outline-success")) {
              icon.style.color = "var(--success)";
            } else if (button.classList.contains("btn-outline-danger")) {
              icon.style.color = "var(--danger)";
            } else {
              icon.style.color = "inherit";
            }
          }
        });

        // Mettre Ã  jour les icÃ´nes dans les cartes de stats
        const statsIcons = document.querySelectorAll(
          ".card.bg-primary .fas, .card.bg-success .fas, .card.bg-warning .fas, .card.bg-danger .fas"
        );
        statsIcons.forEach((icon) => {
          icon.style.color = "#fff";
          icon.style.opacity = "0.9";
        });

        // Mettre Ã  jour les icÃ´nes dans la navigation
        const navIcons = document.querySelectorAll(".navbar-brand .fas");
        navIcons.forEach((icon) => {
          icon.style.color = "var(--primary)";
        });

        // Mettre Ã  jour les icÃ´nes dans les modals
        const modalIcons = document.querySelectorAll(".modal-title .fas");
        modalIcons.forEach((icon) => {
          icon.style.color = "var(--primary)";
        });

        // Mettre Ã  jour les icÃ´nes dans les Ã©tats vides
        const emptyStateIcons = document.querySelectorAll(".empty-state .fas");
        emptyStateIcons.forEach((icon) => {
          if (document.body.classList.contains("dark-mode")) {
            icon.style.color = "#4a5568";
          } else {
            icon.style.color = "#dee2e6";
          }
        });

        // Mettre Ã  jour les icÃ´nes dans les input groups
        const inputGroupIcons = document.querySelectorAll(
          ".input-group-text .fas"
        );
        inputGroupIcons.forEach((icon) => {
          if (document.body.classList.contains("dark-mode")) {
            icon.style.color = "var(--text-light)";
          } else {
            icon.style.color = "var(--text)";
          }
        });

        // Mettre Ã  jour les icÃ´nes dans les boutons de fermeture
        const closeButtons = document.querySelectorAll(".btn-close");
        closeButtons.forEach((button) => {
          if (document.body.classList.contains("dark-mode")) {
            button.style.filter = "invert(1)";
          } else {
            button.style.filter = "none";
          }
        });
      }

      // Dark mode toggle
      document.getElementById("toggle-dark").onclick = toggleDarkMode;

      // Initialize dark mode
      const savedDarkMode = localStorage.getItem("darkMode");
      if (savedDarkMode === "true") {
        document.body.classList.add("dark-mode");
        updateDarkModeIcon(true);
      } else {
        updateDarkModeIcon(false);
      }

      // Appliquer les mises Ã  jour initiales
      updateDarkModeElements();

      // Observer les changements dans le DOM pour mettre Ã  jour les nouveaux Ã©lÃ©ments
      const observer = new MutationObserver(function (mutations) {
        mutations.forEach(function (mutation) {
          if (mutation.type === "childList") {
            // Attendre un peu pour que les styles soient appliquÃ©s
            setTimeout(updateDarkModeElements, 100);
          }
        });
      });

      // DÃ©marrer l'observation
      observer.observe(document.body, {
        childList: true,
        subtree: true,
      });

      // Hide loading screen
      window.addEventListener("load", function () {
        setTimeout(() => {
          document.getElementById("loading-screen").style.display = "none";
        }, 1000);
      });

      // Form validation
      (function () {
        "use strict";
        window.addEventListener(
          "load",
          function () {
            var forms = document.getElementsByClassName("needs-validation");
            var validation = Array.prototype.filter.call(
              forms,
              function (form) {
                form.addEventListener(
                  "submit",
                  function (event) {
                    if (form.checkValidity() === false) {
                      event.preventDefault();
                      event.stopPropagation();
                    }
                    form.classList.add("was-validated");
                  },
                  false
                );
              }
            );
          },
          false
        );
      })();

      // Fonction pour afficher/masquer le champ de catÃ©gorie personnalisÃ©e dans le formulaire d'ajout
      function toggleCustomCategory() {
        const categorySelect = document.getElementById("category");
        const customCategoryInput = document.getElementById("custom-category");

        if (categorySelect.value === "autre") {
          customCategoryInput.style.display = "block";
          customCategoryInput.focus();
        } else {
          customCategoryInput.style.display = "none";
          customCategoryInput.value = "";
        }
      }

      // Fonction pour afficher/masquer le champ de catÃ©gorie personnalisÃ©e dans le modal d'Ã©dition
      function toggleEditCustomCategory() {
        const editCategorySelect = document.getElementById("edit-category");
        const editCustomCategoryInput = document.getElementById(
          "edit-custom-category"
        );

        if (editCategorySelect.value === "autre") {
          editCustomCategoryInput.style.display = "block";
          editCustomCategoryInput.focus();
        } else {
          editCustomCategoryInput.style.display = "none";
          editCustomCategoryInput.value = "";
        }
      }
    </script>
  </body>
</html>
